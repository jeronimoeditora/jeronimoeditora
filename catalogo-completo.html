<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo Completo | Jerónimo Editora</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,900&family=Roboto:wght@300;400;500;700;900&family=Crimson+Text:ital,wght@0,400;0,700;1,400;1,900&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        serif: ['"Playfair Display"', 'serif'],
                        sans: ['"Roboto"', 'sans-serif'],
                        classic: ['"Crimson Text"', 'serif'], 
                    },
                    colors: {
                        'brand-bg': '#F8F8F8', 
                        'brand-text': '#333333', 
                        'brand-accent-red': '#800000', 
                        'brand-accent-blue': '#002147', 
                        'brand-gold': '#cfaf5c', 
                        'brand-gold-dark': '#b38e4a', 
                    }
                }
            }
        }
    </script>

    <style>
        .book-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1), 0 0 5px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        .book-shadow:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        /* Otimização Mobile para evitar zoom automático no iOS */
        input, select, textarea {
            font-size: 16px !important;
        }

        .modal-overlay { cursor: pointer; }
        .modal-content { cursor: default; }
        .fade-in { animation: fadeIn 0.8s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cfaf5c; border-radius: 10px; }
    </style>
</head>
<body class="bg-brand-bg text-brand-text font-sans antialiased flex flex-col min-h-screen">

    <!-- Modal Confirmação Carrinho -->
    <div id="add-to-cart-modal" class="fixed inset-0 z-[100] bg-black bg-opacity-60 flex items-center justify-center hidden modal-overlay" onclick="closeCartConfirmation()">
        <div class="bg-white p-6 rounded-lg shadow-2xl max-w-md w-full mx-4 modal-content relative" onclick="event.stopPropagation()">
            <button onclick="closeCartConfirmation()" class="absolute top-4 right-4 text-gray-400 hover:text-brand-accent-red transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <h3 class="text-2xl font-bold font-serif text-brand-accent-blue mb-5 text-center italic">Item Adicionado!</h3>
            <div id="cart-confirmation-details" class="flex items-center space-x-4 p-3 border border-gray-100 rounded-lg bg-gray-50 mb-6"></div>
            <div class="flex flex-col space-y-3 font-sans">
                <button onclick="closeCartConfirmation()" class="w-full bg-brand-accent-red text-white py-3 rounded-lg font-bold hover:bg-red-900 transition-colors shadow-md">Continuar a Comprar</button>
                <button onclick="window.location.href='checkout.html'" class="w-full bg-brand-gold text-brand-accent-blue font-bold py-3 rounded-lg hover:bg-yellow-600 transition-colors shadow-md">Finalizar Compra</button>
            </div>
        </div>
    </div>

    <!-- Modal Detalhes (+Info) -->
    <div id="info-modal" class="fixed inset-0 z-[100] bg-black bg-opacity-60 flex items-center justify-center hidden modal-overlay" onclick="closeInfoModal()">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-md w-full mx-4 sm:max-w-lg max-h-[90vh] flex flex-col modal-content relative" onclick="event.stopPropagation()">
            <button onclick="closeInfoModal()" class="absolute top-4 right-4 text-gray-400 hover:text-brand-accent-red transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            
            <!-- Título Desktop -->
            <h3 id="info-modal-title" class="hidden sm:block text-xl md:text-2xl font-bold font-serif text-brand-accent-blue mb-4 border-b pb-3 text-center pr-8 tracking-wide"></h3>
            
            <div class="flex flex-col sm:flex-row gap-6 overflow-y-auto custom-scrollbar pr-1">
                <div class="sm:w-2/5 flex flex-col items-center">
                    <img id="info-modal-image" src="" alt="Capa" class="w-32 h-48 md:w-40 md:h-56 object-contain rounded-lg shadow-md mb-3" />
                </div>
                <div class="sm:w-3/5 space-y-4">
                    <!-- Título Mobile -->
                    <h3 id="info-modal-title-mobile" class="sm:hidden text-xl font-bold font-serif text-brand-accent-blue text-center mb-1 leading-tight"></h3>
                    
                    <!-- Resumo maior -->
                    <p id="info-modal-summary" class="text-gray-700 italic leading-relaxed text-base md:text-lg font-classic"></p>
                    
                    <div class="pt-2 border-t border-gray-100 font-sans text-sm">
                        <!-- Linha de Preço + Botão Detalhes -->
                        <div class="flex items-center justify-between mb-4">
                            <p class="font-bold text-brand-accent-red text-xl md:text-2xl font-classic" id="info-modal-price"></p>
                            <a id="info-modal-details-link" href="detalhes.html" class="inline-flex items-center justify-center bg-brand-accent-blue text-white px-4 md:px-7 py-2 rounded-lg font-bold text-sm hover:bg-brand-accent-red transition-all shadow-md">
                                <span class="md:hidden text-lg">+</span>
                                <span class="hidden md:inline">+ Detalhes</span>
                            </a>
                        </div>
                        
                        <ul class="text-xs md:text-sm text-gray-500 space-y-2">
                            <li id="info-modal-author"></li>
                            <li id="info-modal-isbn"></li>
                            <li id="info-modal-pages"></li>
                            <li id="info-modal-weight"></li>
                            <li id="info-modal-format"></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 pt-4 border-t border-gray-100 flex flex-col items-center gap-3">
                <button id="info-modal-add-to-cart" onclick="modalAddToCart()" class="w-full bg-brand-accent-red text-white py-4 rounded-lg font-bold uppercase tracking-widest hover:bg-red-900 transition-all shadow-md active:scale-95 text-base md:text-lg font-sans">
                    ADICIONAR AO CARRINHO
                </button>
                <button onclick="closeInfoModal()" class="text-sm text-gray-400 hover:text-brand-accent-red transition-colors font-semibold py-2 font-sans">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- CONTENTOR DO MENU -->
    <div id="nav-placeholder"></div>

    <main class="flex-grow pt-24 md:pt-32 pb-12"> 
        <div class="max-w-6xl mx-auto px-4 md:px-6 text-center fade-in">
            <!-- Título -->
            <h1 class="font-serif text-4xl sm:text-5xl text-brand-accent-blue mb-4 border-b pb-3 text-center border-brand-accent-blue/30 font-normal">
                Catálogo Completo
            </h1>
            
            <!-- Barra de Pesquisa e Filtros -->
            <div class="mt-2 mb-12 flex flex-col bg-white p-4 rounded-xl shadow-md border border-gray-100 text-left max-w-5xl mx-auto font-sans">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 items-center w-full">
                    <div class="border border-gray-200 rounded-lg overflow-hidden h-10 flex items-center">
                        <input type="text" id="search-input" placeholder="Pesquisar livros..." class="w-full h-full px-3 text-sm outline-none bg-transparent" onkeyup="filterAndSortBooks()">
                    </div>
                    <select id="category-filter" class="h-10 px-3 border border-gray-200 rounded-lg bg-white text-sm cursor-pointer outline-none focus:border-brand-gold" onchange="filterAndSortBooks()">
                        <option value="all">Todas as Categorias</option>
                        <option value="Estudos Bíblicos">Estudos Bíblicos</option>
                        <option value="Apologética">Apologética</option>
                        <option value="Teologia">Teologia</option>
                    </select>
                    <select id="sort-order" class="h-10 px-3 border border-gray-200 rounded-lg bg-white text-sm cursor-pointer outline-none focus:border-brand-gold" onchange="filterAndSortBooks()">
                        <option value="default">Ordenar Por...</option>
                        <option value="az">Título (A-Z)</option>
                        <option value="price-asc">Preço (Crescente)</option>
                    </select>
                    <button onclick="clearFiltersAndSort()" class="h-10 bg-brand-accent-blue text-white font-bold rounded-lg hover:bg-brand-accent-red transition-all text-sm px-4">
                        Limpar Filtros
                    </button>
                </div>
            </div>

            <p id="no-results" class="col-span-full text-center text-xl text-gray-500 hidden py-10">Nenhum livro encontrado.</p>
            <div id="book-list-container" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-10 justify-center"></div>
        </div>
    </main>

    <!-- CONTENTOR DO RODAPÉ -->
    <div id="footer-placeholder"></div>

    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzuJ1ztOjQvdZdRf1gkZHEGDXcJPzYHqECnknKrbrhRaPZdNI4ZvOYIzD1wLrASxlc/exec'; 
        
        const bookData = [
            { id: 3, title: "Tu podes compreender a Bíblia", author: "Peter Kreeft", price: 15.00, category: "Estudos Bíblicos", image: "Imagens/Kreeft2.png", summary: "Um guia prático para cada livro da Bíblia", techDetails: { pages: 316, isbn: "978-989-36716-0-3", binding: "Capa Mole", weight: "0,350 kg" }, visible: true, detailsUrl: "detalhes.html" },
            { id: 2, title: "Jesus e o Jubileu", author: "John S. Bergsma", price: 22.00, category: "Estudos Bíblicos", image: "Imagens/Bergsma.png", summary: "O livro explora a conexão entre o ministério de Jesus e a lei do Jubileu.", techDetails: { pages: 280, isbn: "978-989-98218-2-2", binding: "Capa Mole", weight: "0,420 kg" }, visible: false, detailsUrl: "detalhes-bergsma.html" },
            { id: 7, title: "Duras Palavras", author: "Trent Horn", price: 0.00, category: "Apologética", image: "https://placehold.co/400x600/f3f4f6/333333?text=Brevemente", summary: "Uma exploração profunda sobre os ensinamentos difíceis da fé.", techDetails: { pages: 0, isbn: "A definir", binding: "A definir", weight: "A definir" }, visible: true, isComingSoon: true },
            { id: 1, title: "Suma Teológica", author: "São Tomás de Aquino", price: 75.00, category: "Teologia", image: "Imagens/suma_teologica.png", visible: false },
            { id: 4, title: "Convite aos Salmos", author: "Rolf A. Jacobson & Karl N. Jacobson", price: 28.50, category: "Teologia", image: "Imagens/Jacobson.png", visible: false }
        ];

        function getSafePath(file) {
            const currentUrl = window.location.href;
            if (currentUrl.startsWith('blob:') || currentUrl.startsWith('file:')) return file; 
            try { 
                const baseUrl = window.location.origin + window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);
                return new URL(file, baseUrl).href; 
            } catch (e) { return file; }
        }

        async function loadComponents() {
            try {
                const navResp = await fetch(getSafePath('menu.html'));
                if (navResp.ok) document.getElementById('nav-placeholder').innerHTML = await navResp.text();
                const footResp = await fetch(getSafePath('rodape.html'));
                if (footResp.ok) document.getElementById('footer-placeholder').innerHTML = await footResp.text();
                updateCartUI();
            } catch (e) { console.warn("Ambiente local detectado."); }
        }

        function formatPrice(p) { return `€ ${p.toFixed(2).replace('.', ',')}`; }
        function closeCartConfirmation() { document.getElementById('add-to-cart-modal').classList.add('hidden'); }
        function closeInfoModal() { document.getElementById('info-modal').classList.add('hidden'); }
        
        function addToCart(bookId, bookTitle) {
            let cartItems = JSON.parse(localStorage.getItem('cartItems') || '[]');
            const book = bookData.find(b => b.id === bookId);
            if (!book || book.isComingSoon) return;
            const existing = cartItems.findIndex(item => item.id === bookId);
            if (existing > -1) { cartItems[existing].quantity += 1; } 
            else { cartItems.push({ id: bookId, title: bookTitle, price: book.price, quantity: 1, image: book.image, author: book.author }); }
            localStorage.setItem('cartItems', JSON.stringify(cartItems));
            updateCartUI();
            document.getElementById('cart-confirmation-details').innerHTML = `<img src="${book.image}" class="w-12 h-16 object-contain" /><div><h4 class="font-bold text-sm">${book.title}</h4><p class="text-brand-accent-red font-bold text-sm">${formatPrice(book.price)}</p></div>`;
            document.getElementById('add-to-cart-modal').classList.remove('hidden');
        }

        function openInfoModal(bookId) {
            const book = bookData.find(b => b.id === bookId);
            if (!book || book.isComingSoon) return;
            
            document.getElementById('info-modal-title').textContent = book.title;
            document.getElementById('info-modal-title-mobile').textContent = book.title;
            document.getElementById('info-modal-image').src = book.image;
            document.getElementById('info-modal-summary').textContent = book.summary;
            document.getElementById('info-modal-price').textContent = formatPrice(book.price);
            document.getElementById('info-modal-author').textContent = `Autor: ${book.author}`;
            document.getElementById('info-modal-isbn').textContent = `ISBN: ${book.techDetails.isbn}`;
            document.getElementById('info-modal-pages').textContent = `Páginas: ${book.techDetails.pages}`;
            document.getElementById('info-modal-weight').textContent = `Peso: ${book.techDetails.weight}`;
            document.getElementById('info-modal-format').textContent = `Formato: ${book.techDetails.binding}`;
            
            const detailsLink = document.getElementById('info-modal-details-link');
            detailsLink.href = book.detailsUrl || 'detalhes.html';
            
            document.getElementById('info-modal').dataset.activeBookId = bookId;
            document.getElementById('info-modal').classList.remove('hidden');
        }

        function modalAddToCart() {
             const bookId = parseInt(document.getElementById('info-modal').dataset.activeBookId);
             const book = bookData.find(b => b.id === bookId);
             if (book && !book.isComingSoon) { addToCart(bookId, book.title); closeInfoModal(); }
        }

        function filterAndSortBooks() {
            const term = document.getElementById('search-input').value.toLowerCase().trim();
            const category = document.getElementById('category-filter').value;
            const sort = document.getElementById('sort-order').value;
            
            let filtered = bookData.filter(b => {
                const matchesSearch = b.title.toLowerCase().includes(term) || b.author.toLowerCase().includes(term);
                const matchesCategory = category === 'all' || b.category === category;
                return b.visible && matchesSearch && matchesCategory;
            });

            if (sort === 'az') filtered.sort((a, b) => a.title.localeCompare(b.title));
            else if (sort === 'price-asc') filtered.sort((a, b) => a.price - b.price);
            renderBooks(filtered);
        }

        function renderBooks(books) {
            const container = document.getElementById('book-list-container');
            container.innerHTML = '';
            document.getElementById('no-results').classList.toggle('hidden', books.length > 0);
            
            const infoIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="mr-0 md:mr-1"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>`;
            const cartIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" class="mr-0 md:mr-1"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.5 2.5h2l2 11h11l1-6h5.5"/><path d="m20.5 7-1.4 5.2a1 1 0 0 1-.95.8H7.5"/><path d="M8 8h9"/><path d="M17 17H7.5"/></svg>`;
            
            books.forEach(b => {
                const priceDisplay = b.isComingSoon ? 'Brevemente' : formatPrice(b.price);
                const btnClass = b.isComingSoon ? 'bg-gray-300 cursor-not-allowed text-gray-500' : 'bg-brand-accent-blue text-white hover:bg-brand-accent-red shadow-sm';
                const infoBtnClass = b.isComingSoon ? 'text-gray-400 border-gray-400 cursor-not-allowed' : 'text-brand-accent-blue border-2 border-brand-accent-blue hover:bg-gray-50 shadow-sm';
                
                container.innerHTML += `
                    <div class="text-center group book-shadow bg-white rounded-xl p-4 md:p-6 flex flex-col justify-between cursor-pointer" onclick="${b.isComingSoon ? '' : `openInfoModal(${b.id})`}">
                        <div class="flex-grow">
                            <div class="overflow-hidden rounded-lg mb-4 md:mb-6 flex justify-center py-4 md:py-6 bg-gray-50">
                                <img src="${b.image}" class="w-24 h-36 md:w-36 md:h-52 object-contain transition-transform duration-500 group-hover:scale-105" />
                            </div>
                            <!-- Ajustado: removido line-clamp-2 para mostrar o título completo -->
                            <h4 class="font-serif text-base md:text-lg text-brand-text font-bold group-hover:text-brand-accent-red transition-colors duration-200 leading-tight">${b.title}</h4>
                            <p class="text-[11px] md:text-sm text-gray-500 italic mt-2">${b.author}</p>
                            <span class="text-lg md:text-xl font-classic font-extrabold ${b.isComingSoon ? 'text-gray-400' : 'text-brand-accent-red'} mt-3 block">${priceDisplay}</span>
                        </div>
                        <div class="flex items-center justify-center mt-5 md:mt-6 border-t pt-4 space-x-2 md:space-x-3">
                            <button class="${infoBtnClass} transition-all font-bold py-2 px-2 md:px-5 rounded-lg flex items-center justify-center h-10 md:h-11" onclick="${b.isComingSoon ? '' : `openInfoModal(${b.id})`}; event.stopPropagation();">
                                ${infoIcon} <span class="hidden md:inline ml-1 text-sm">Info</span>
                            </button>
                            <button class="${btnClass} py-2 px-2 md:px-5 rounded-lg flex items-center justify-center h-10 md:h-11 transition-all font-bold" onclick="${b.isComingSoon ? '' : `addToCart(${b.id}, '${b.title}')`}; event.stopPropagation();">
                                ${cartIcon} <span class="hidden md:inline ml-1 text-sm">Comprar</span>
                            </button>
                        </div>
                    </div>`;
            });
        }

        function clearFiltersAndSort() {
            document.getElementById('search-input').value = '';
            document.getElementById('category-filter').value = 'all';
            document.getElementById('sort-order').value = 'default';
            filterAndSortBooks();
        }

        function updateCartUI() {
            const items = JSON.parse(localStorage.getItem('cartItems') || '[]');
            const total = items.reduce((s, i) => s + i.quantity, 0);
            document.querySelectorAll('#cart-count, #cart-count-mobile').forEach(el => {
                if (el) {
                    el.textContent = total;
                    el.classList.toggle('opacity-0', total === 0);
                }
            });
        }

        function toggleMenu() { 
            const menu = document.getElementById('mobile-menu');
            if (menu) menu.classList.toggle('hidden'); 
        }

        window.onload = () => { 
            loadComponents();
            filterAndSortBooks(); 
        };
    </script>
</body>
</html>